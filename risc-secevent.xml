<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type='text/xsl' href='http://xml2rfc.tools.ietf.org/authoring/rfc2629.xslt' ?>
<!DOCTYPE rfc PUBLIC "-//IETF//DTD RFC 2629//EN" "http://xml2rfc.tools.ietf.org/authoring/rfc2629.dtd">
<!--
  NOTE:  This XML file is input used to produce the authoritative copy of an
  OpenID Foundation specification.  The authoritative copy is the HTML output.
  This XML source file is not authoritative.  The statement ipr="none" is
  present only to satisfy the document compilation tool and is not indicative
  of the IPR status of this specification.  The IPR for this specification is
  described in the "Notices" section.  This is a public OpenID Foundation
  document and not a private document, as the private="..." declaration could
  be taken to indicate.
-->

<rfc docName="risc-secevent-00" category="std" ipr="none">

  <?rfc toc="yes" ?>
  <?rfc tocdepth="5" ?>
  <?rfc symrefs="yes" ?>
  <?rfc sortrefs="yes"?>
  <?rfc strict="yes" ?>
  <?rfc iprnotified="no" ?>
  <?rfc private="Draft" ?>
  <?rfc comments="yes"?>

  <front>
    <title abbrev="risc-secevent">RISC profile of IETF Security Events</title>

    <author initials="M." surname="Scurtescu" fullname="Marius Scurtescu">
      <organization abbrev="Google">Google</organization>
      <address>
        <email>mscurtescu@google.com</email>
      </address>
    </author>
    <author initials="A." surname="Backman" fullname="Annabelle Backman">
      <organization abbrev="Amazon">Amazon</organization>
      <address>
        <email>richanna@amazon.com</email>
      </address>
    </author>
    <author initials="P." surname="Hunt" fullname="Phil Hunt">
      <organization abbrev="Oracle">Oracle Corporation</organization>
      <address>
        <email>phil.hunt@yahoo.com</email>
      </address>
    </author>
    <author initials="J." surname="Bradley" fullname="John Bradley">
      <organization abbrev="Yubico">Yubico</organization>
      <address>
        <email>secevemt@ve7jtb.com</email>
      </address>
    </author>

    <date year="2017" month="October" day="13"/>

    <workgroup>RISC Working Group</workgroup>

    <abstract>
      <t>This is a RISC profile for several IETF Security Events drafts:</t>

      <t><list style="symbols">
        <t><xref target="SET">Security Event Token (SET)</xref></t>
        <t><xref target="DELIVERY">SET Token Delivery Using HTTP</xref></t>
        <t><xref target="API">Management API for SET Event Streams</xref></t>
      </list></t>
    </abstract>
  </front>

  <middle>
    <section anchor="intro" title="Introduction">
      <section anchor="conv" title="Notational Conventions">
        <t>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”,
        “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this
        document are to be interpreted as described in <xref target="RFC2119"/>.</t>
      </section>
    </section>

    <section title="Profiles">
      <t>This section profiles several IETF secevent specifications.</t>
      
      <t>The RISC Profile makes several assumptions:<list style="symbols">
        <t>Transmitters are OpenID Connect Identity Providers</t>
        <t>Receivers are OpenID Connect Clients and as such have client ids issued by Transmitters</t>
        <t>In general the way subjects are identified is similar to
          <xref target="OIDC">OpenID Connect</xref> and
          <xref target="IDTOKEN">Id Tokens</xref> in particular.</t>
      </list></t>

      <t>The RISC use cases that set the requirements are described in
        <xref target="USECASES">"Security Events RISC Use Cases"</xref>.</t>
      
      <section anchor="set-profle" title="Security Event Token Profle">
        <t>This section provides RISC profiling specifications for the
          <xref target="SET">"Security Event Token (SET)"</xref> spec.</t>
        
        <section anchor="signature-key-resolution" title="Signature Key Resolution">
          <t>TODO: pointer to Management API section that describes discovery doc and the
          property that points to the key.</t>
        </section>
        
        <section title="Composite Subject Claim">
          <t>TODO</t>
        </section>
        
        <section title="Security Considerations">
          <t>TODO: Id Token and Access Token confusion</t>
        </section>
      </section>
  
      <section anchor="set-token-delivery-using-http-profile" title="SET Token Delivery Using HTTP Profile">
        <t>This section provides RISC profiling specifications for the 
          <xref target="DELIVERY">"SET Token Delivery Using HTTP"</xref> spec.</t>
        
        <section title="Authorization">
          <t>TODO</t>
        </section>
      </section>
  
      <section anchor="management-api-for-set-event-streams-profile" title="Management API for SET Event Streams Profile">
        <t>This section provides RISC profiling specifications for the 
          <xref target="API">"Management API for SET Event Streams"</xref> spec.</t>
        
        <section title="Authorization">
          <t>HTTP API calls from a receiver to a transmitter SHOULD be authorized using OAuth 2 Access Tokens.
          The client id associated with the Access Token uniquely identifies the Receiver and the Stream.</t>
          
          <t>Receivers SHOULD use the <xref target="CLIENTCRED">Client Credential Grant</xref> to obtain
            access tokens on its own behalf.</t>
        </section>
        
        <section title="Subject Claims for Subject Add and Remove Operations">
          <t>TODO</t>
        </section>
      </section>
    </section>
    
    <section anchor="event-types" title="Event Types">
      <section anchor="account-credential-change-required" title="Account Credential Change Required">
        <t>Event Type URI:<vspace blankLines="0" />
        http://schemas.openid.net/secevent/risc/event-type/account-credential-change-required</t>
        
        <t>Account Credential Change Required signals that the account identified by the subject was required to
        change a credential. For example the user was required to go through a password change.</t>
        
        <t>Attributes: none</t>
      </section>

      <section anchor="account-deleted" title="Account Deleted">
        <t>Event Type URI:<vspace blankLines="0" />
        http://schemas.openid.net/secevent/risc/event-type/account-deleted</t>
        
        <t>Account Deleted signals that the account identified by the subject has been permanently deleted.</t>
        
        <t>Attributes: none</t>
      </section>

      <section anchor="account-disabled" title="Account Disabled">
        <t>Event Type URI:<vspace blankLines="0" />
        http://schemas.openid.net/secevent/risc/event-type/account-disabled</t>
        
        <t>Account Disabled signals that the account identified by the subject has been disabled. The actual reason why the
        account was disabled might be specified with the nested 'reason' attribute described below. The account may be
        <xref target="account-enabled">enabled</xref> in the future.</t>
        
        <t>Attributes:<list style="symbols">
          <t>reason - optional, describes why was the account disabled. Possible values:<list style="symbols">
            <t>hijacking</t>
            <t>bulk-account</t>
          </list></t>
          <t>cause-time - the initial cause that lead to the account to be disabled. In most cases this is an 
          estimated time. For example, the actual hijacking time. This is before the event time.</t>
        </list></t>
      </section>

      <section anchor="account-enabled" title="Account Enabled">
        <t>Event Type URI:<vspace blankLines="0" />
        http://schemas.openid.net/secevent/risc/event-type/account-enabled</t>
        
        <t>Account Enabled signals that the account identified by the subject has been enabled.</t>
        
        <t>Attributes: none</t>
      </section>

      <section anchor="identifier-changed" title="Identifier Changed">
        <t>Event Type URI:<vspace blankLines="0" />
        http://schemas.openid.net/secevent/risc/event-type/identifier-changed</t>
        
        <t>Identifier Changed signals that the identifier specified in the subject has changed. The subject
        MUST be either 'email' or 'phone-number' and it MUST specify the old value.</t>
        
        <t>Attributes:<list style="symbols">
          <t>new-value - required, the new value of the identifier.</t>
        </list></t>
      </section>

      <section anchor="identifier-recycled" title="Identifier Recycled">
        <t>Event Type URI:<vspace blankLines="0" />
        http://schemas.openid.net/secevent/risc/event-type/identifier-recycled</t>
        
        <t>Identifier Recycled signals that the identifier specified in the subject was recycled and now it
        belongs to a new user. The subject MUST be either 'email' or 'phone-number'.</t>
        
        <t>Attributes: none</t>
      </section>

      <section anchor="opt-out" title="Opt Out">
        <t>Users SHOULD be allowed to opt-in and out of RISC events being sent for their accounts. With regards
        to opt-out an account can be in one of these three states:<list style="numbers">
          <t>opt-in - the account is participating in RISC event exchange.</t>
          <t>opt-out-initiated - the user requested to be excluded from RISC event exchanges, but for
          practical security reasons for a period of time RISC events are still exchanged. The main reason
          for this state is to prevent a hijacker from immediately opting out of RISC.</t>
          <t>opt-out - the account is NOT participating in RISC event exchange.</t>
        </list></t>
        
        <figure anchor="opt-out-states">
          <preamble>State changes trigger Opt-Out Events as represented bellow:</preamble>
          <artwork><![CDATA[
          +--------+  opt-out-initiated  +-------------------+
          |        +--------------------->                   |
          | opt-in |                     | opt-out-initiated |
          |        |  pt-out-cancelled   |                   |
          |        <---------------------+                   |
          +---^----+                     +----------+--------+
              |                                     |
              | opt-in                              | opt-out-effective
              |                                     |
              |                          +----------V--------+
              |                          |                   |
              +--------------------------| opt-out           |
                                         |                   |
                                         +-------------------+
          ]]></artwork>
          <postamble>Opt-Out States and Opt-Out Events</postamble>
        </figure>
        
        <t>Both Transmitters and Receivers SHOULD manage Opt-Out state for users. Transmitters should send the
        events defined in this section when the Opt-Out state changes.</t>
        
        <section anchor="opt-in" title="Opt In">
          <t>Event Type URI:<vspace blankLines="0" />
          http://schemas.openid.net/secevent/risc/event-type/opt-in</t>
        
          <t>Opt In signals that the account identified by the subject opted into RISC event exchanges.
          The account is in the 'opt-in' state.</t>
        
          <t>Attributes: none</t>
        </section>
        
        <section anchor="opt-out-initiated" title="Opt Out Initiated">
          <t>Event Type URI:<vspace blankLines="0" />
          http://schemas.openid.net/secevent/risc/event-type/opt-out-initiated</t>
        
          <t>Opt Out Initiated signals that the account identified by the subject initiated to opt out
          from RISC event exchanges. The account is in the 'opt-out-initiated' state.</t>
        
          <t>Attributes: none</t>
        </section>
        
        <section anchor="opt-out-cancelled" title="Opt Out Cancelled">
          <t>Event Type URI:<vspace blankLines="0" />
          http://schemas.openid.net/secevent/risc/event-type/opt-out-cancelled</t>
        
          <t>Opt Out Cancelled signals that the account identified by the subject cancelled the opt out from RISC
          event exchanges. The account is in the 'opt-in' state.</t>
        
          <t>Attributes: none</t>
        </section>
        
        <section anchor="opt-out-effective" title="Opt Out Effective">
          <t>Event Type URI:<vspace blankLines="0" />
          http://schemas.openid.net/secevent/risc/event-type/opt-out-effective</t>
        
          <t>Opt Out Effective signals that the account identified by the subject was effectively opted out from
          RISC event exchanges. The account is in the 'opt-out' state.</t>
        
          <t>Attributes: none</t>
        </section>
      </section>
      
      <section anchor="recovery-activated" title="Recovery Activated">
        <t>Event Type URI:<vspace blankLines="0" />
        http://schemas.openid.net/secevent/risc/event-type/recovery-activated</t>
        
        <t>Recovery Activated signals that the account identified by the subject activated a recovery flow.</t>
        
        <t>Attributes: none</t>
      </section>

      <section anchor="recovery-information-changed" title="Recovery Information Changed">
        <t>Event Type URI:<vspace blankLines="0" />
        http://schemas.openid.net/secevent/risc/event-type/recovery-information-changed</t>
        
        <t>Recovery Information Changed signals that the account identified by the subject has changed some of
        its recovery information. For example a recovery email address was added or removed.</t>
        
        <t>Attributes: none</t>
      </section>

      <section anchor="sessions-revoked" title="Sessions Revoked">
        <t>Event Type URI:<vspace blankLines="0" />
        http://schemas.openid.net/secevent/risc/event-type/sessions-revoked</t>
        
        <t>Sessions Revoked signals that all the sessions for the account identified by the subject have been
        revoked.</t>
        
        <t>Attributes: none</t>
      </section>
    </section>
  </middle>

  <back>
    <references title='Normative References'>

      <reference  anchor="JSON" target='https://www.rfc-editor.org/info/rfc7159'>
        <front>
          <title>The JavaScript Object Notation (JSON) Data Interchange Format</title>
            <author initials='T.' surname='Bray' fullname='T. Bray' role='editor'><organization /></author>
            <date year='2014' month='March' />
            <abstract><t>JavaScript Object Notation (JSON) is a lightweight, text-based, language-independent data interchange format.  It was derived from the ECMAScript Programming Language Standard.  JSON defines a small set of formatting rules for the portable representation of structured data.</t><t>This document removes inconsistencies with other specifications of JSON, repairs specification errors, and offers experience-based interoperability guidance.</t></abstract>
        </front>
        <seriesInfo name='RFC' value='7159'/>
        <seriesInfo name='DOI' value='10.17487/RFC7159'/>
      </reference>

      <reference  anchor="RFC7519" target='https://www.rfc-editor.org/info/rfc7519'>
        <front>
          <title>JSON Web Token (JWT)</title>
            <author initials='M.' surname='Jones' fullname='M. Jones'><organization /></author>
            <author initials='J.' surname='Bradley' fullname='J. Bradley'><organization /></author>
            <author initials='N.' surname='Sakimura' fullname='N. Sakimura'><organization /></author>
            <date year='2015' month='May' />
            <abstract><t>JSON Web Token (JWT) is a compact, URL-safe means of representing claims to be transferred between two parties.  The claims in a JWT are encoded as a JSON object that is used as the payload of a JSON Web Signature (JWS) structure or as the plaintext of a JSON Web Encryption (JWE) structure, enabling the claims to be digitally signed or integrity protected with a Message Authentication Code (MAC) and/or encrypted.</t></abstract>
        </front>
        <seriesInfo name='RFC' value='7519'/>
        <seriesInfo name='DOI' value='10.17487/RFC7519'/>
      </reference>

      <reference anchor="SET" target="https://tools.ietf.org/html/draft-ietf-secevent-token">
        <front>
          <title>Security Event Token (SET)</title>
          <author >
            <organization>IETF</organization>
          </author>
          <date/>
        </front>
      </reference>

      <reference anchor="DELIVERY" target="https://tools.ietf.org/html/draft-ietf-secevent-delivery">
        <front>
          <title>SET Token Delivery Using HTTP</title>
          <author >
            <organization>IETF</organization>
          </author>
          <date/>
        </front>
      </reference>

      <reference anchor="API" target="https://tools.ietf.org/html/draft-scurtescu-secevent-simple-control-plane">
        <front>
          <title>Management API for SET Event Streams</title>
          <author >
            <organization>IETF</organization>
          </author>
          <date/>
        </front>
      </reference>

      <reference anchor="USECASES" target="https://tools.ietf.org/html/draft-scurtescu-secevent-risc-use-cases-00">
        <front>
          <title>Security Events RISC Use Cases</title>
          <author >
            <organization>IETF</organization>
          </author>
          <date/>
        </front>
      </reference>

      <reference anchor="CLIENTCRED" target="https://tools.ietf.org/html/rfc6749#section-4.4">
        <front>
          <title>The OAuth 2.0 Authorization Framework - Client Credentials Grant</title>
          <author initials="D." surname="Hardt" fullname="D. Hardt"><organization>Microsoft</organization></author>
          <date/>
        </front>
        <seriesInfo name="RFC" value="6749"/>
      </reference>

      <reference anchor="OIDC" target="http://openid.net/specs/openid-connect-core-1_0.html">
        <front>
          <title>OpenID Connect Core 1.0</title>
          <author><organization>OpenID Foundation</organization></author>
          <date/>
        </front>
      </reference>
      
      <reference anchor="IDTOKEN" target="http://openid.net/specs/openid-connect-core-1_0.html#IDToken">
        <front>
          <title>OpenID Connect Core 1.0 - ID Token</title>
          <author><organization>OpenID Foundation</organization></author>
          <date/>
        </front>
      </reference>
      
      <reference  anchor="RFC2119" target='https://www.rfc-editor.org/info/rfc2119'>
        <front>
          <title>Key words for use in RFCs to Indicate Requirement Levels</title>
          <author initials='S.' surname='Bradner' fullname='S. Bradner'><organization /></author>
          <date year='1997' month='March' />
          <abstract><t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract>
        </front>
        <seriesInfo name='BCP' value='14'/>
        <seriesInfo name='RFC' value='2119'/>
        <seriesInfo name='DOI' value='10.17487/RFC2119'/>
      </reference>
    </references>
  </back>
</rfc>

